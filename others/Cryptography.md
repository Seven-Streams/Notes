# 第一章 密码学和数据安全导论

密码分析学和密码使用学的区别

密码使用学的三个主要分支：对称算法、非对称算法、密码协议。

## 1、对称密码学（单密钥）

明文、密文、密钥。所有可能的密钥组成的集合称为密钥空间。

替换密码：**不安全**

穷举法

字母频率分析

好的密码应该隐藏被加密文本的统计属性！

## 2、密码分析

主要分为三种：古典密码分析、旁道攻击、社会工程攻击。

### Kerckhoffs原理

安全的密码体系必须保证除密钥外，加密算法和解密算法等的公开不会影响加密的安全性。

### 密钥长度

只有当穷举是最好的破解方法是，讨论密钥长度才有意义。

## 3、模运算与古典密码

扩展概念的模运算

在每一个剩余类中，所有成员行为等价

### 整数环

整数环包括从0到k的整数。定义：

$$
a+b\leftrightarrow (a+b)mod(k+1) \\
c\times d\leftrightarrow (c\times d)mod(k+1)
$$

如果环对加法和乘法封闭，那么这个环就是封闭的。

加法和乘法满足结合律。

存在加法和乘法的恒等变换。

存在加法逆元。

对于一个元素而言，存在它的乘法逆元，当且仅当其与模数互质。

rmk：整数环是不是一个线性空间？

### 移位密码

### 仿射密码

加密和解密过程可以这样理解：

$$
e_k(x)=y\equiv (ax+b)mod26\\
d_k(y)=x\equiv a^{-1}(y-b)mod26



$$

这种条件下要求存在乘法逆元，故$gcd(a,26)=1$。

尽管仿射加密比移位加密好一些，但没有好到哪里去。

# 第二章 序列密码（流密码）

## 1、序列密码简介

序列密码单独对每个**明文**位进行加密。加密和解密使用同一种方法。即：与给定的密钥取异或。

因此，密钥序列的安全性是序列密码的核心问题。

## 2、随机数

真随机数生成器(TRNG)：基于物理过程。输出具有不可复制性。

伪随机数生成器(PRNG)：通过一个种子，运算得到一个随机数。根据得到的结果修改种子。为了保证随机，这类函数要保证结果足够均匀。

加密安全的伪随机数生成器(CSPRNG)：要求结果具有不可预知性。不能通过前一次随机数的发生结果判断下一次的发生结果。通常可以使用真随机种子来执行。

无条件安全：无论多少计算资源，也无法破译，那么称为无条件安全。

一次一密(OTP)：通过真随机数生成器得到密钥序列。只有合法的通信者才知道密钥。密钥序列中，每一位只使用一次。那么，称其为一次一密。

一次一密具有无条件安全性。

但是，OTP很少使用。一方面，一般的PC没有TRNG。并且，为了加密和解密，需要等同大小的密钥，并且双方还需要进行交换。

一般而言，我们使用伪随机数生成器。

一般而言，密码只能做到计算安全。

如果使用PRNG构建密码流，那么当文件所有密文和部分明文泄露时，密钥就很容易被攻破。因此，才出现了CSPRNG。

## 3、基于移位寄存器的序列密码

### LFSR

简单而言，它使用了一个寄存器。在每一个tick内，寄存器内容右移1位，同时得到一份输出值。与此同时，根据上一个tick寄存器中各个位的状态，挑选其中的部分，对它们进行异或操作，得到左端最高位的输入。异或操作的对象是保密的。密钥就是挑选了哪些位数进行异或。

但是，由于LFSR是线性的，只要能够对应密钥序列长度两倍之多的明文和密文，通过求解线性方程组，就可以破解密钥。

### Trivium

这种算法使用了三个寄存器。可以认为它们中的内容以类似环的方式排布。只有当密钥和初始向量都知道的情况下，这种加密才会被攻破。

# 第三章 数据加密标准(DES)与替换算法

## 1、DES

### 混淆与扩散

根据香农的理论，强加密算法都基于以下两种操作：Confusion和Diffusion。Confusion是为了模糊明文与密文的关系。而Diffusion则是为了抹除明文的统计属性。

### 算法概述

DES是一种对称密码。它是一种分组密码。DES算法对每个块中的数据都会进行16轮加密。

密钥长度为64位，其中8位为校验位，故密码实际长度为56位。

第一步：IP置换

分块。每个块中有64位。使用IP表将64位进行互相交换。

随后，将64bit的数据分为左侧32位和右侧32位。左32位使用Feistel网络处理。右32位使用f函数处理。然后，交换左侧和右侧。

f函数的过程：先将8组4bit扩展为8组6bit。这一步中使用了扩展函数E。将扩展后的48为与密钥进行异或操作。将8组6bit送入8个S-盒中，重新得到8组4bit。这一步是非线性的。因为$S(a\oplus b)\not=S(a)\oplus S(b)$

Feistel结构：左32位等于上次右32位。右32位等于上次f函数结果与上次左32位取异或。

## 2、DES的替换算法

AES、3DES、DESX、PRESENT

# 第四章 高级加密标准(AES)

## 1、AES——Rijndael算法

Rijndael算法中没有Feistel网络。

明文首先会经过一次密钥加法。

明文会经过n次的：字节代换(S-盒)、扩散(行移位和列混淆)、密钥加法。

### 伽罗瓦域(有限域)

#### 群

群的概念：封闭性，操作满足结合律，存在全等操作，存在逆元。

如果一个群的群操作满足交换律，那么这个群就是阿贝尔群。

#### 域

一个域中的所有元素构成一个加法群。中性元为0。

一个域中除0外所有元素构成一个乘法群。中性元为1。

域中的所有元素满足乘法分配律。

#### 域的阶

域中元素的个数。

当且仅当m是一个素数的正整数幂时，阶为m的域才存在。

#### 素数域

阶为素数的域。加法和乘法意为带模加法与乘法。

这个域中的元素为0,1,2,...,n-1

GF(2)={0,1}

#### 扩展域

GF($2^8$)显然不是一个素数域。我们称这是一个扩展域。

对于这个域中的元素，我们可以用这样的方式来表示：

$$
A=a_72^7+...+a_12^1+a_0,a_i\in \{ 0,1\}
$$

很显然，这就是二进制的表示方式。

在扩展域中，我们这样定义加法：

$$
A+B=\sum_{i=0}^7((a_i\oplus b_i)*2^i
$$

从程序员的角度看，这不过就是异或罢了。

在扩展域中，我们这样定义乘法：

$$
P=\sum_{i=0}^7p_i*2^i,要求P是一个不可约多项式\\
A\times B=(\sum_{i=0}^7a_i2^i)(\sum_{i=0}^7b_i2^i)modP
$$

P必须是不可约的。

### AES的具体过程

在字节代换层，即通过S-盒进行了一次混淆。S-盒是一个双射，所以是可逆的。但是，S-盒是一个非线性操作。

在扩散层，首先进行ShiftRow。在这一步中，状态矩阵的每一行移动了不同的量。这一步是线性的。

随后，进行MixColumn。在这一步中，实际上进行了在GF(2^8)中的一次乘法。

在密钥加密层，就是将明文与密钥进行了一次异或操作。

Rmk：S盒是一个重要的操作。它破坏了加密时的线性性，增大了密码线性分析法的难度。

# 第五章 分组密码的更多内容

## 1、电子密码本模式(ECB)

这种情况下，相同的明文都会映射到相同的密文。导致安全性的缺失。

## 2、密码分组链接模式(CBC)

所有分组的加密都链接在一起。同时，每一段的密钥初始向量进行了随机化。

Rmk：每一个区块的加密情况与上一个区块有关。

## 3、输出反馈模式(OFB)

每进行一次加密，就会对密钥进行一次改变。并且这个改变与明文无关。

## 4、密码反馈模式(CFB)

每进行一次加密，就会根据密文对密钥进行一次改变。

## 5、计数器模式(CTR)

选择一个合适的初始值，计数器将其递增，并得到不同的密钥，将这些密钥作用于加密。

计数器模式可以进行并行操作，这是OFB和CFB所不具有的。

## 6、伽罗瓦计数器模式(GCM)

相较于CTR增加了验证操作。保证数据的正确性。

## 7、双重加密和中间人攻击

当进行两次加密时，一种相对高效地攻击方法是中间人攻击。即，先从左侧尝试蛮力攻击，再从右侧进行蛮力攻击。这样，只要找到匹配的中间值即可。复杂度为破解一侧加密的复杂度的2倍。

# 第六章 公钥密码学简介

## 1、引入

单向函数的定义：正向计算是容易的，反向计算在计算上不可行。

具有实用性的三类公钥算法：整数分解方案，离散对数方案，椭圆曲线方案。

## 2、基本数论知识

辗转相除法

扩展辗转相除法：可以计算模操作的逆元。

欧拉函数，记$\Phi(m)为Z_m中与m$互素的整数个数。

若$m=p_1^{e_1}p_2^{e_2}...p_n^{e_n}$

则$\Phi(m)=\prod_{i=1}^n(p_i^{e_i}-p_i^{e_i-1})$

费马小定理:a为整数，p为素数

$$
a^p\equiv a(mod\ p)\\

$$

欧拉定理

当gcd(a,m)=1时

$$
a^{\Phi (m)} \equiv 1(mod\ m) 
$$

# 第七章 RSA密码体制

## 1、加密与解密

### RSA密钥的生成

选择两个大素数p，q，令n=p*q

那么，$\Phi(n)=(p-1)(q-1)$

再选择一个数$e\in Z_{\Phi(n)}$

满足$gcd(e,\Phi(n))=1$

计算一个私钥d，$d\cdot e \equiv 1mod(\Phi(n))$

### RSA的加密

使用短公开指数或是中国剩余定理

## 2、大素数

### 费马素性测试

即利用费马小定理，找是否存在与1同余的数。

错误率较高。

### Miller-Rabin素性测试

## 3、攻击

协议攻击

数学分析攻击

旁道攻击：从物理角度攻击。比如电流活跃情况。

# 第八章 基于离散对数问题的公钥密码体制

## 1、Diffie-Hellman密钥交换

联合密钥

双方共同选定一个大素数和一个整数。并将它们公开。随后，双方用对方的公钥和自己的私钥进行加密，可以得到一个共同的密钥。

## 2、数学知识

群中，一个元素是k阶的，指a^k=1,1是单位元。

一个群中，阶数最大的元素称为原根。

如果群中存在一个元素的阶数与群的阶数相同，那么这个群是循环群。拥有最大阶的元素称为原根。群中每个元素都可以写作原根的幂。

对于一个素数p，$Z_p^{*}$是一个阿贝尔 有限 循环 群。

如果一个群是有限群，那么$a^{|G|}=1$，并且任何一个元素的阶数都可以整除群的阶数。

对于一个有限 循环 群G，其中有$\Phi (|G|)$个原根。如果G的阶数是素数，那么，G中任何不为1的数都是原根。

对于一个循环群G，G中每个阶数为s的元素，都是拥有s个元素的循环子群的原根。

任何一个子群的阶数都可以整除整个群的阶数。

G是一个n阶的有限循环群，$\alpha$为原根，那么，对整除n的每个整数k，G都存在一个唯一阶数为k的循环子群。

## 3、离散对数问题

$$
\alpha^x\equiv \beta\ mod\ p\\
x =log_{\alpha}\beta\ mod \ p
$$

计算指数很简单，但反向计算是困难的。

## 4、Elgamal加密方案

首先，双方选定大素数和原根，获得公共密钥。

然后，运用公共密钥作为乘法掩码，加密信息。

最后，收信方利用公共密钥解密。

# 第九章 椭圆曲线密码体制

## 1、椭圆曲线

椭圆曲线$Z_p$定义为：

$$
y^2\equiv x^3+ax+b\ mod\ p\\
4a^3+27b^2\not \equiv 0\ mod \ p
$$

以及一个无穷大的虚数点。

椭圆曲线上，不同点的加法，定义为坐标之和

相同点的加法，定义为该点处的切线与椭圆曲线交点关于x轴的对称。

## 2、椭圆曲线构建离散对数问题

在椭圆曲线上选定一个起点，我们用快速幂的思路，令其自我相加很多次。然后再随意加上几次，得到一个终点。破解者为了破解密码，不得不穷举。

# 第十章 数字签名

数字签名是用Hash函数对填充后的信息生成的值再加盐，再次hash之后的摘要与自身私钥作用的结果。对方可以使用公钥验签。这一过程的安全性主要还是由上述三种方法保证。

# 第十一章 哈希函数

## 1、哈希函数的安全性要求

单向性、弱抗冲突性、计算抗冲突性

## 2、常见的哈希函数

### MD4

### SHA-1

# 第十二章 消息验证码

## 1、MAC

根据对称密钥和信息得到。比非对称密钥来得快速。

这样是为了避免发生信息的篡改。

但是，它不具有不可否认性。

## 2、几种常见的方式

HMAC、分组MAC(使用密码链方式加密，CBC)、伽罗瓦计数器MAC

# 第十三章 密钥建立

## 1、密钥刷新与密钥衍生

利用已有的密钥和一个衍生值，通过一个单向函数计算得到新的密钥。

## 2、使用密钥分配中心的密钥建立

密钥分配中心与每个用户都共享一个密钥。从而保证用户间密钥传递的安全性。

通过指明密钥的生存周期，和发信人的ID，可以提高其安全性，避免重演攻击等情况。

## 3、证书

CA体系

证书的吊销
